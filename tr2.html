<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financeiro Completo - Sistema de Vôlei</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* [Todos os estilos originais do segundo código permanecem aqui] */
        
        /* Adicionando estilos específicos do perfil do integrante */
        .profile-container {
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .profile-header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }
        
        .profile-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #3498db;
        }
        
        .nav-arrow {
            background-color: #3498db;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .nav-arrow:hover {
            background-color: #2980b9;
        }
        
        .profile-details {
            text-align: center;
        }
        
        .profile-name {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .profile-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .info-item {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
        }
        
        .info-label {
            font-weight: bold;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .info-value {
            color: #2c3e50;
            margin-top: 5px;
        }
        
        .payment-status {
            margin-top: 30px;
        }
        
        .status-title {
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .status-month {
            color: #2c3e50;
        }
        
        .status-value {
            font-weight: bold;
        }
        
        .status-value.paid {
            color: #27ae60;
        }
        
        .status-value.unpaid {
            color: #e74c3c;
        }
        
        .pending-alert {
            background-color: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .no-pending {
            background-color: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .search-container {
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
    </style>
</head>
<body>
     <div class="header">
        <h2><i class="fas fa-volleyball-ball" style="color:#3498db;"></i>
             Vôlei-BNH </h2>
        <button class="login-btn" onclick="window.location.href='index.html'"><i class="fas fa-sign-in-alt"></i>&nbsp;Área Restrita</button>
    </div>
    
    <div class="container">
        <br>
        <div class="tabs">
            <div class="tab active" data-tab="report"><i class="fas fa-file-alt"></i> Contribuições</div>
            <div class="tab" data-tab="expenses"><i class="fas fa-receipt"></i> Despesas</div>
            <div class="tab" data-tab="players"><i class="fas fa-users"></i> Integrantes</div>
        </div>
        
        <div id="report" class="tab-content active">
            <!-- [Conteúdo original da aba de contribuições permanece aqui] -->
        </div>
        
        <div id="expenses" class="tab-content">
            <!-- [Conteúdo original da aba de despesas permanece aqui] -->
        </div>
        
        <!-- NOVA ABA DE INTEGRANTES -->
        <div id="players" class="tab-content">
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Pesquisar integrante...">
            </div>
            
            <div class="profile-container">
                <div class="profile-header">
                    <button id="prevPlayer" class="nav-arrow">←</button>
                    
                    <img id="profilePhoto" class="profile-photo" src="" alt="Foto do integrante">
                    
                    <button id="nextPlayer" class="nav-arrow">→</button>
                </div>
                
                <div class="profile-details">
                    <h2 id="profileName" class="profile-name">Carregando...</h2>
                    
                    <div class="profile-info">
                        <div class="info-item">
                            <div class="info-label">Posição</div>
                            <div id="playerPosition" class="info-value">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Categoria</div>
                            <div id="playerCategory" class="info-value">-</div>
                        </div>
                       
                        <div class="info-item">
                            <div class="info-label">Contato</div>
                            <div id="playerContact" class="info-value">-</div>
                        </div>

                         <div class="info-item">
                            <div class="info-label">Data de Nascimento</div>
                            <div id="playerBirthdate" class="info-value">-</div>
                        </div>
                    </div>
                    
                    <div class="payment-status">
                        <h3 class="status-title">Status das Contribuições</h3>
                        <div id="paymentsList">
                            <!-- Os pagamentos serão carregados aqui -->
                        </div>
                    </div>
                    
                    <div id="pendingStatus" class="pending-alert" style="display: none;">
                        Este integrante possui pendências!
                    </div>
                    
                    <div id="noPendingStatus" class="no-pending" style="display: none;">
                        Integrante em dia com as Contribuições!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getDatabase, ref, get, onValue } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyAWMgLaPMpNOdPW10S-bVVEiQW-r3QCkxg",
            authDomain: "volei-25301.firebaseapp.com",
            databaseURL: "https://volei-25301-default-rtdb.firebaseio.com",
            projectId: "volei-25301",
            storageBucket: "volei-25301.firebasestorage.app",
            messagingSenderId: "1007197261034",
            appId: "1:1007197261034:web:f2c7ab9cb2793a694cdb93",
            measurementId: "G-CYMLX0SJJQ"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // [Todo o código JavaScript original do segundo arquivo permanece aqui]
        
        // ===== CÓDIGO DA NOVA ABA DE INTEGRANTES =====
        // Elementos DOM da aba de integrantes
        const profilePhoto = document.getElementById('profilePhoto');
        const profileName = document.getElementById('profileName');
        const playerPosition = document.getElementById('playerPosition');
        const playerCategory = document.getElementById('playerCategory');
        const playerBirthdate = document.getElementById('playerBirthdate');
        const playerContact = document.getElementById('playerContact');
        const paymentsList = document.getElementById('paymentsList');
        const prevPlayerBtn = document.getElementById('prevPlayer');
        const nextPlayerBtn = document.getElementById('nextPlayer');
        const searchInput = document.getElementById('searchInput');
        const pendingStatus = document.getElementById('pendingStatus');
        const noPendingStatus = document.getElementById('noPendingStatus');

        // Variáveis globais para integrantes
        let players = [];
        let currentPlayerIndex = 0;
        let filteredPlayers = [];

        // Carregar todos os jogadores
        async function loadPlayers() {
            try {
                const playersRef = ref(database, 'players');
                const snapshot = await get(playersRef);
                
                if (snapshot.exists()) {
                    players = Object.entries(snapshot.val()).map(([id, player]) => ({ id, ...player }));
                    
                    // Ordenar jogadores por nome (ordem alfabética)
                    players.sort((a, b) => a.name.localeCompare(b.name));
                    
                    filteredPlayers = [...players];
                    
                    if (filteredPlayers.length > 0) {
                        currentPlayerIndex = 0;
                        showPlayer(currentPlayerIndex);
                    } else {
                        profileName.textContent = "Nenhum integrante cadastrado";
                    }
                } else {
                    profileName.textContent = "Nenhum integrante cadastrado";
                }
            } catch (error) {
                console.error("Error loading players: ", error);
                profileName.textContent = "Erro ao carregar dados";
            }
        }

        // Mostrar jogador atual
        function showPlayer(index) {
            if (filteredPlayers.length === 0) return;
            
            // Garantir que o índice está dentro dos limites
            if (index < 0) index = filteredPlayers.length - 1;
            if (index >= filteredPlayers.length) index = 0;
            
            currentPlayerIndex = index;
            const player = filteredPlayers[index];
            
            // Atualizar informações básicas
            profileName.textContent = player.name || "-";
            playerPosition.textContent = player.position || "-";
            playerCategory.textContent = player.category || "-";
            playerBirthdate.textContent = player.birthdate ? formatDate(player.birthdate) : "-";
            playerContact.textContent = player.contact || "-";
            
            // Atualizar foto
            if (player.imageUrl) {
                profilePhoto.src = player.imageUrl;
                profilePhoto.style.display = "block";
            } else {
                profilePhoto.style.display = "none";
            }
            
            // Carregar pagamentos do jogador
            loadPlayerPayments(player.id);
            
            // Atualizar estado dos botões de navegação
            prevPlayerBtn.disabled = filteredPlayers.length <= 1;
            nextPlayerBtn.disabled = filteredPlayers.length <= 1;
        }

        // Carregar pagamentos do jogador
        async function loadPlayerPayments(playerId) {
            try {
                const paymentsRef = ref(database, 'payments');
                const snapshot = await get(paymentsRef);
                const payments = snapshot.val() || {};
                
                // Filtrar pagamentos do jogador atual
                const playerPayments = Object.values(payments)
                    .filter(p => p.playerId === playerId)
                    .sort((a, b) => b.month.localeCompare(a.month)); // Ordenar do mais recente
                
                renderPayments(playerPayments);
                
                // Verificar se há pendências
                const hasPending = playerPayments.some(p => p.value === 0 || p.value === '0');
                
                if (hasPending) {
                    pendingStatus.style.display = "block";
                    noPendingStatus.style.display = "none";
                } else {
                    pendingStatus.style.display = "none";
                    noPendingStatus.style.display = "block";
                }
                
            } catch (error) {
                console.error("Error loading payments: ", error);
                paymentsList.innerHTML = "<div>Erro ao carregar pagamentos</div>";
            }
        }

        // Renderizar lista de pagamentos
        function renderPayments(payments) {
            paymentsList.innerHTML = '';
            
            if (payments.length === 0) {
                paymentsList.innerHTML = "<div>Nenhum pagamento registrado</div>";
                return;
            }
            
            payments.forEach(payment => {
                const isPaid = payment.value > 0;
                const [year, month] = payment.month.split('-');
                const monthName = getMonthName(month);
                
                const paymentEl = document.createElement('div');
                paymentEl.className = 'status-item';
                paymentEl.innerHTML = `
                    <div class="status-month">${monthName}/${year}</div>
                    <div class="status-value ${isPaid ? 'paid' : 'unpaid'}">
                        ${isPaid ? `R$ ${parseFloat(payment.value).toFixed(2)}` : 'Não pago'}
                    </div>
                `;
                paymentsList.appendChild(paymentEl);
            });
        }

        // Navegação entre jogadores
        prevPlayerBtn.addEventListener('click', () => {
            showPlayer(currentPlayerIndex - 1);
        });
        
        nextPlayerBtn.addEventListener('click', () => {
            showPlayer(currentPlayerIndex + 1);
        });

        // Pesquisa de jogadores
        searchInput.addEventListener('input', () => {
            const searchTerm = searchInput.value.trim().toLowerCase();
            
            if (searchTerm === '') {
                filteredPlayers = [...players];
            } else {
                filteredPlayers = players.filter(player => 
                    player.name.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredPlayers.length > 0) {
                currentPlayerIndex = 0;
                showPlayer(currentPlayerIndex);
            } else {
                profileName.textContent = "Nenhum integrante encontrado";
                paymentsList.innerHTML = "";
                pendingStatus.style.display = "none";
                noPendingStatus.style.display = "none";
            }
        });

        // Helper functions para a aba de integrantes
        function formatDate(dateString) {
            if (!dateString) return '-';
            
            const date = new Date(dateString);
            const offset = date.getTimezoneOffset() * 60000;
            const adjustedDate = new Date(date.getTime() + offset);
            
            return adjustedDate.toLocaleDateString('pt-BR');
        }
        
        function getMonthName(monthNumber) {
            const months = [
                'Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun',
                'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'
            ];
            return months[parseInt(monthNumber) - 1];
        }

        // Carregar jogadores quando a aba for ativada
        document.querySelector('.tab[data-tab="players"]').addEventListener('click', loadPlayers);
        
        // Carregar jogadores inicialmente se a aba estiver ativa
        if (document.querySelector('.tab[data-tab="players"].active')) {
            loadPlayers();
        }
    </script>
</body>
</html>
